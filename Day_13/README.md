Used quite a few inline table functions to make it more managable.
